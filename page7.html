<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–¶–µ–ø—å –ø–∏—Ç–∞–Ω–∏—è</title>
  <style>
    body {
      margin: 0;
      height: 100dvh;
      overflow: hidden;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e5e7eb;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 12px;
      box-sizing: border-box;
      touch-action: pan-y;
    }
    h1 { margin: 12px 0 20px; font-size: clamp(1.7rem, 4.8vw, 2.2rem); text-shadow: 0 0 20px #60a5fa88; text-align: center; }
    .footer { margin-top: 16px; font-size: 12px; opacity: 0.65; }
    .container {
      background: rgba(15, 23, 42, 0.75);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(96,165,250,0.3);
      border-radius: 24px;
      padding: 20px;
      width: 100%;
      max-width: 600px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.6);
      position: relative;
      overflow: hidden;
    }
    .target-chain {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      min-height: 110px;
      padding: 16px;
      border: 2px dashed rgba(96,165,250,0.4);
      border-radius: 16px;
      margin-bottom: 20px;
      background: rgba(30,41,59,0.3);
    }
    .slot {
      width: 90px;
      height: 90px;
      border: 2px solid rgba(96,165,250,0.3);
      border-radius: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(15,23,42,0.5);
      transition: all 0.3s ease;
      position: relative;
    }
    .slot.filled {
      border-color: #60a5fa;
      background: rgba(96,165,250,0.12);
      box-shadow: 0 0 20px rgba(96,165,250,0.3);
    }
    .slot::after {
      content: attr(data-order);
      position: absolute;
      top: -10px; right: -10px;
      background: #1e293b;
      color: #94a3b8;
      font-size: 0.8rem;
      width: 22px; height: 22px;
      border-radius: 50%;
      display: flex;
      align-items: center; justify-content: center;
      border: 1px solid #475569;
    }
    .components {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 24px;
    }
    .component {
      width: 82px;
      height: 82px;
      background: rgba(30,41,59,0.6);
      border-radius: 14px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: grab;
      user-select: none;
      transition: all 0.25s ease;
      box-shadow: 0 6px 16px rgba(0,0,0,0.4);
      font-size: 1.9rem;
      touch-action: manipulation;
      position: relative;
      -webkit-user-select: none;
      user-select: none;
    }
    .component.dragging {
      position: fixed !important;     /* ‚Üê –∫–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç */
      pointer-events: none;           /* —á—Ç–æ–±—ã –Ω–µ –º–µ—à–∞–ª —Å–æ–±—ã—Ç–∏—è–º –ø–æ–¥ —Å–æ–±–æ–π */
      z-index: 9999;
      opacity: 0.85;
      transform: scale(1.1);
      box-shadow: 0 12px 40px rgba(96,165,250,0.6);
    }
    .component-name {
      font-size: 0.75rem;
      margin-top: 4px;
      color: #94a3b8;
      text-align: center;
      line-height: 1.1;
    }
    .success-line {
      position: absolute;
      top: 50%; left: 0;
      width: 100%; height: 4px;
      background: linear-gradient(90deg, transparent, #34d399, #10b981, #34d399, transparent);
      transform: translateY(-50%);
      opacity: 0;
      transition: opacity 1.5s;
      box-shadow: 0 0 30px #34d399;
      pointer-events: none;
    }
    .success-line.active {
      opacity: 0.8;
      animation: flow 3s linear infinite;
    }
    @keyframes flow {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }
    .answer {
      margin-top: 20px;
      font-size: 2.6rem;
      font-weight: 900;
      color: #34d399;
      text-shadow: 0 0 40px #34d399, 0 0 80px #059669;
      opacity: 0;
      transform: translateY(30px);
      transition: all 1.5s ease;
      line-height: 1;
    }
    .answer.show {
      opacity: 1;
      transform: translateY(0);
      animation: pulseText 2.5s ease-in-out infinite alternate;
    }
    @keyframes pulseText {
      0% { text-shadow: 0 0 30px #34d399; }
      100% { text-shadow: 0 0 60px #34d399, 0 0 100px #059669; }
    }
    .hold-progress {
      position: absolute;
      inset: -6px;
      border: 3px solid rgba(96,165,250,0.0);
      border-radius: 50%;
      pointer-events: none;
      box-sizing: border-box;
      opacity: 0;
      transform: scale(0.8);
    }
    .component.hold-active .hold-progress {
      opacity: 1;
      animation: holdFill 0.4s linear forwards;
    }
    @keyframes holdFill {
      0% { border-color: rgba(96,165,250,0.2); transform: scale(0.8); }
      100% { border-color: #60a5fa; transform: scale(1.15); }
    }
  </style>
</head>
<body>
<h1>–ü—Ä–æ–≤–µ–¥–∏ –ø–∏—Ç–∞–Ω–∏–µ –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∫ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—é (–º–∏–Ω–∏–º—É–º –Ω—É–∂–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤).</h1>
<div class="container">
  <div class="target-chain" id="targetChain">
    <div class="slot" data-order="1" data-expected="panel"></div>
    <div class="slot" data-order="2" data-expected="battery"></div>
    <div class="slot" data-order="3" data-expected="inverter"></div>
    <div class="slot" data-order="4" data-expected="pred"></div>
    <div class="slot" data-order="5" data-expected="load"></div>
  </div>
  <div class="success-line" id="successLine"></div>
  <div class="components" id="components">
    <div class="component" data-type="load">
      <div class="hold-progress"></div>
      <span>üè†</span>
      <div class="component-name">–ë—ã—Ç–æ–≤—ã–µ –ø—Ä–∏–±–æ—Ä—ã</div>
    </div>
    <div class="component" data-type="battery">
      <div class="hold-progress"></div>
      <span>üîã</span>
      <div class="component-name">–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä</div>
    </div>
    <div class="component" data-type="inverter">
      <div class="hold-progress"></div>
      <span>‚ö°</span>
      <div class="component-name">–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å —Ç–æ–∫–∞</div>
    </div>
    <div class="component" data-type="panel">
      <div class="hold-progress"></div>
      <span>‚òÄÔ∏è</span>
      <div class="component-name">–°–æ–ª–Ω–µ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å</div>
    </div>
    <div class="component" data-type="pred">
      <div class="hold-progress"></div>
      <span>üîå</span>
      <div class="component-name">–ü—Ä–µ–¥–æ—Ö—Ä–∞–Ω–∏—Ç–µ–ª—å</div>
    </div>
    <div class="component" data-type="counter">
      <div class="hold-progress"></div>
      <span>üìä</span>
      <div class="component-name">–°—á—ë—Ç—á–∏–∫</div>
    </div>
  </div>
  <div class="answer" id="answer">–¶–ï–ü–¨</div>
  <div class="footer">¬∑ –†–û–ë–û–°–ò–ë ¬∑ 2026</div>
</div>

<script>
  const components = document.querySelectorAll('.component');
  const slots = document.querySelectorAll('.slot');
  const successLine = document.getElementById('successLine');
  const answer = document.getElementById('answer');
  const correctOrder = ['panel', 'battery', 'inverter', 'pred', 'load'];

  let dragged = null;
  let offsetX = 0;
  let offsetY = 0;

  // MOBILE: touch
  components.forEach(comp => {
    comp.addEventListener('touchstart', e => {
      if (dragged) return;
      dragged = comp;
      const rect = comp.getBoundingClientRect();
      const touch = e.touches[0];

      // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º —Å–º–µ—â–µ–Ω–∏–µ –æ—Ç —Ç–æ—á–∫–∏ –∫–∞—Å–∞–Ω–∏—è –¥–æ —Ü–µ–Ω—Ç—Ä–∞/—É–≥–ª–∞ –∫–∞—Ä—Ç–æ—á–∫–∏
      offsetX = touch.clientX - rect.left - rect.width / 2;
      offsetY = touch.clientY - rect.top - rect.height / 2;

      comp.classList.add('hold-active', 'dragging');
      comp.style.opacity = '0.85';

      // –°—Ä–∞–∑—É –ø–µ—Ä–µ–º–µ—â–∞–µ–º –≤ fixed, —á—Ç–æ–±—ã —Å–ª–µ–¥–æ–≤–∞–ª –∑–∞ –ø–∞–ª—å—Ü–µ–º
      comp.style.left = `${rect.left + window.scrollX}px`;
      comp.style.top  = `${rect.top + window.scrollY}px`;
      comp.style.width = `${rect.width}px`;
      comp.style.height = `${rect.height}px`;

      e.preventDefault();
    }, { passive: false });

    comp.addEventListener('touchmove', e => {
      if (!dragged) return;
      e.preventDefault();

      const touch = e.touches[0];
      dragged.style.left = `${touch.clientX - offsetX - dragged.offsetWidth / 2}px`;
      dragged.style.top  = `${touch.clientY - offsetY - dragged.offsetHeight / 2}px`;
    }, { passive: false });

    comp.addEventListener('touchend', e => {
      if (!dragged) return;

      dragged.classList.remove('hold-active', 'dragging');
      dragged.style.opacity = '1';

      const touch = e.changedTouches[0];
      const elemUnder = document.elementFromPoint(touch.clientX, touch.clientY);
      const targetSlot = elemUnder?.closest('.slot');

      if (targetSlot) {
        const existing = targetSlot.querySelector('.component');
        if (existing) {
          document.getElementById('components').appendChild(existing);
        }
        targetSlot.innerHTML = '';
        targetSlot.appendChild(dragged);
        targetSlot.style.background = 'rgba(15,23,42,0.5)';
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º inline-—Å—Ç–∏–ª–∏ –ø–æ—Å–ª–µ –¥—Ä–æ–ø–∞
        dragged.style.left = '';
        dragged.style.top = '';
        dragged.style.width = '';
        dragged.style.height = '';
        checkChain();
      } else {
        // –ï—Å–ª–∏ –æ—Ç–ø—É—Å—Ç–∏–ª–∏ –Ω–µ –Ω–∞–¥ —Å–ª–æ—Ç–æ–º ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ
        dragged.style.left = '';
        dragged.style.top = '';
        dragged.style.width = '';
        dragged.style.height = '';
      }

      dragged = null;
    }, { passive: false });
  });

  // DESKTOP: mouse (–æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ—á—Ç–∏ –∫–∞–∫ –±—ã–ª–æ)
  components.forEach(comp => {
    comp.addEventListener('dragstart', e => {
      dragged = comp;
      e.dataTransfer.setData('text/plain', comp.dataset.type);
      comp.classList.add('dragging');
      comp.style.opacity = '0.6';
    });

    comp.addEventListener('dragend', () => {
      if (dragged) {
        dragged.style.opacity = '1';
        dragged.classList.remove('dragging');
        dragged = null;
      }
    });
  });

  slots.forEach(slot => {
    slot.addEventListener('dragover', e => {
      e.preventDefault();
      slot.style.background = 'rgba(96,165,250,0.2)';
    });

    slot.addEventListener('dragleave', () => {
      slot.style.background = 'rgba(15,23,42,0.5)';
    });

    slot.addEventListener('drop', e => {
      e.preventDefault();
      if (!dragged) return;

      const existing = slot.querySelector('.component');
      if (existing) {
        document.getElementById('components').appendChild(existing);
      }
      slot.innerHTML = '';
      slot.appendChild(dragged);
      slot.style.background = 'rgba(15,23,42,0.5)';
      dragged.style.opacity = '1';
      dragged.classList.remove('dragging');
      checkChain();
      dragged = null;
    });
  });

  function checkChain() {
    const filledSlots = Array.from(slots).map(slot => {
      const comp = slot.querySelector('.component');
      return comp ? comp.dataset.type : null;
    });
    const isCorrect = filledSlots.every((type, i) => type === correctOrder[i]);
    if (isCorrect) {
      successLine.classList.add('active');
      answer.classList.add('show');
    } else {
      successLine.classList.remove('active');
    }
  }
</script>
</body>
</html>
