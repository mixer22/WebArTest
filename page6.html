<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Ветряная батарейка</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: #0f172a;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
  color: #e5e7eb;
}

h1 {
  margin-bottom: 20px;
  text-align: center;
}

/* Батарейка */
.battery-container {
  width: 80px;
  height: 160px;
  border: 4px solid #94a3b8;
  border-radius: 12px;
  position: relative;
  overflow: hidden;
  background: #1e293b;
  margin-bottom: 30px;
}

.battery-fill {
  position: absolute;
  bottom: 0;
  width: 100%;
  height: 0%;
  background: linear-gradient(180deg, #34d399, #059669);
  transition: height 0.3s ease;
  border-radius: 6px 6px 0 0;
  box-shadow: 0 0 10px #34d39955 inset;
}

.battery-tip {
  position: absolute;
  top: -10px;
  left: 25%;
  width: 50%;
  height: 10px;
  background: #94a3b8;
  border-radius: 4px 4px 0 0;
}

/* Ветряк */
.windmill {
  width: 140px;
  height: 140px;
  margin-bottom: 20px;
  position: relative;
  touch-action: none;
}

.windmill svg {
  width: 100%;
  height: 100%;
  user-select: none;
  transform-origin: 50% 50%;
}

/* Лопасти */
.blade {
  fill: #e5e7eb;
  stroke: #94a3b8;
  stroke-width: 1;
}

/* Слово-ответ */
.answer {
  margin-top: 20px;
  font-size: 24px;
  font-weight: bold;
  color: #34d399;
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.5s, transform 0.5s;
}

.answer.show {
  opacity: 1;
  transform: translateY(0);
}
</style>
</head>

<body>

<h1>⚡ Заряди батарейку!</h1>

<div class="windmill" id="windmill">
  <svg viewBox="0 0 100 100">
    <g id="blades" transform="rotate(0 50 50)">
      <!-- Нарисуем 4 лопасти треугольниками -->
      <polygon class="blade" points="50,50 52,10 48,10"/>
      <polygon class="blade" points="50,50 90,52 90,48" transform="rotate(90 50 50)"/>
      <polygon class="blade" points="50,50 52,90 48,90" transform="rotate(180 50 50)"/>
      <polygon class="blade" points="50,50 10,52 10,48" transform="rotate(270 50 50)"/>
      <circle cx="50" cy="50" r="5" fill="#94a3b8"/>
    </g>
  </svg>
</div>

<div class="battery-container">
  <div class="battery-fill" id="batteryFill"></div>
  <div class="battery-tip"></div>
</div>

<div class="answer" id="answer">ЭНЕРГИЯ</div>

<script>
const fill = document.getElementById("batteryFill");
const answer = document.getElementById("answer");
const windmill = document.getElementById("windmill");
const blades = document.getElementById("blades");

let charge = 0;
let rotation = 0;
let lastAngle = null;

// Функция плавного увеличения батарейки
function increaseCharge(amount) {
  charge += amount;
  if(charge > 100) charge = 100;
  fill.style.height = charge + "%";

  if(charge >= 100) {
    answer.classList.add("show");
  }
}

// Вычисление угла между точкой и центром
function getAngle(x, y, cx, cy) {
  return Math.atan2(y - cy, x - cx) * (180 / Math.PI);
}

// Обработка drag вращения
function startDrag(e) {
  const rect = windmill.getBoundingClientRect();
  const cx = rect.left + rect.width / 2;
  const cy = rect.top + rect.height / 2;

  function onMove(ev) {
    const clientX = ev.touches ? ev.touches[0].clientX : ev.clientX;
    const clientY = ev.touches ? ev.touches[0].clientY : ev.clientY;
    const angle = getAngle(clientX, clientY, cx, cy);
    if(lastAngle !== null) {
      let delta = angle - lastAngle;
      // корректируем прыжки через 180°
      if(delta > 180) delta -= 360;
      if(delta < -180) delta += 360;
      rotation += delta;
      blades.setAttribute("transform", `rotate(${rotation} 50 50)`);
      increaseCharge(Math.abs(delta)*0.5); // заряд пропорционален вращению
    }
    lastAngle = angle;
  }

  function endDrag() {
    lastAngle = null;
    window.removeEventListener("mousemove", onMove);
    window.removeEventListener("mouseup", endDrag);
    window.removeEventListener("touchmove", onMove);
    window.removeEventListener("touchend", endDrag);
  }

  window.addEventListener("mousemove", onMove);
  window.addEventListener("mouseup", endDrag);
  window.addEventListener("touchmove", onMove);
  window.addEventListener("touchend", endDrag);

  e.preventDefault();
}

windmill.addEventListener("mousedown", startDrag);
windmill.addEventListener("touchstart", startDrag);
</script>

</body>
</html>
